/*
* @fileOverview 对话框组件
*
* @author 周继良 (zhongyongsheng@ceopen.cn)
* @version 1.8.9
*/
(function(i){i.uiwidget=i.uiwidget||{};i.fn.wBox=function(s){return new i.uiwidget.WBox(s)};var g={wBoxURL:"images/",opacity:0.5,callBack:null,onClose:null,requestType:"iframe",target:null,showClose:true,timeout:0,param:null,iframeID:"iframe",iframeWH:{width:"",height:""},position:null,html:"",title:"",disableBackSpace:true,disableBSInputType:["button","checkbox","file","image","radio","reset","submit"],showMask:true,drag:true};i.uiwidget.WBox=function(s){this.options=i.extend({},g,s);this.init();this.showBox();return this};i.uiwidget.WBox.prototype={init:function(){var s=this.options;this.param=s.param;var y=i(top.window);var w=top.window.document;var x=i(top.window.document.body);c();this.winIndex=top.$(".wbox-wrapper").length+1;this.winId="wBox-"+this.winIndex;var v=w.createElement("div");i(v).attr("id",this.winId);i(v).addClass("wbox-wrapper");i(v).addClass("wbox-live");var u='<div class="wBox_popup"><table cellspacing="0" cellpadding="0" class="wbox"><tr class="wbox-header"><td class="left"/><td class="mid wBox_dragTitle"><span class="wBox_itemTitle">'+s.title+"</span>"+(s.showClose?'<a href="#" class="wBox_close" title="关闭"></a>':"")+'</td><td class="right"/></tr><tr class="wbox-body"><td class="left">&nbsp;</td><td><div class="wBox_body"><div class="wBox_content wBoxContent" ></div></div></td><td class="right"><div>&nbsp;</div></td></tr><tr class="wbox-bottom"><td class="left"/><td class="mid"/><td class="right"/></tr></table></div>';i(v).append(u);w.body.appendChild(v)},showBox:function(){var s=this.options;var u=i(top.window);this.showMask();if(s.fullScreen){s.iframeWH={width:u.width(),height:u.height()}}else{s.iframeWH=b(this.options)}k(this.winId,this.options);$maskOverlay=null;u=null},showMask:function(){var F=this.options;var s=i(top.window.document.body);var A=i(top.window.document);var w=i(top.window);var D=null;var v=s.find("#wBox_overlay").length>0;if(v){var B=s.find("#wBox_overlay");var u=B.css("z-index");var E=A.height(),z=w.height(),C=A.width(),y=w.width();E=Math.max(E,z);C=Math.max(C,y);D=B.css("z-index",parseInt(u)+2).css("width",C).css("height",E)}else{D=i("<div id='wBox_overlay' tabIndex='-1'></div>").addClass("wBox_overlayBG").css("opacity",F.opacity).appendTo(s);s.find("#wBox_overlay").keydown(function(G){return f(G,F)})}if(F.showMask===false){D.hide()}else{D.show()}var x=top.$("#"+this.winId);x.css("z-index",parseInt(D.css("z-index"))+1);s=null;w=null;A=null;x=null;D=null},cancel:function(){p(this.winId,null,null)},close:function(){var u=this.options;var s=arguments;p(this.winId,u.onClose,arguments)},reload:function(u){var s=this.options;var v=top.$("#"+this.winId).find("iframe");if(s.iframeWH.height){v.height(s.iframeWH.height)}else{v.height("")}if(s.iframeWH.width){v.width(s.iframeWH.width)}else{v.width("")}if(u){v.attr("src",u)}else{v.load(s.target)}},changeTitle:function(s){var u=top.$("#"+this.winId);u.find("span.wBox_itemTitle").html(s);u.find("iframe").attr("title",s);u.find("iframe")[0].contentWindow.document.title=s},progressBar:function(s){var x=top.$("#"+this.winId);var v="";var w=document.getElementsByTagName("script");for(var u=0;u<w.length;u++){if(w[u].src&&w[u].src.substring(w[u].src.lastIndexOf("/")+1)=="progressbar-min.js"){v=w[u].src.substring(0,w[u].src.lastIndexOf("/")+1)}}if(v==""){alert("请引入progressbar-min.js组件");return}x.find("#processbar").progressBar(s,{boxImage:v+"images/progressbar.gif",barImage:{0:v+"images/progressbg_green.gif",30:v+"images/progressbg_green.gif",70:v+"images/progressbg_green.gif"}})}};var h=8;function b(s){if(top.$(".wbox-ruler").length<1){top.$('<div class="wbox-ruler" style="z-index:-1; display:none"><div>').appendTo(top.window.document.body)}var u=top.$(".wbox-ruler");if(s.iframeWH&&s.iframeWH.width!==""){u.width(s.iframeWH.width)}if(s.iframeWH&&s.iframeWH.height!==""){u.height(s.iframeWH.height)}return{width:u.width(),height:u.height()}}function k(x,F){var w=top.$("#"+x);var z=w.find(".wBoxContent");if(F.requestType&&F.requestType=="iframe"){z.html("<div class='wBox_load'><div id='wBox_loading'></div></div>");var A=top.window.document;var v=i(top.window);var u=A.createElement("iframe");var G=i(u);G.attr("id",F.iframeID+"_iframe-"+x);G.attr("name","wBoxIframe");G.attr("title",F.title);G.attr("src",F.target);G.attr("scrolling","auto");G.attr("frameborder","0");if(F.fullScreen===true){var C=v.height();var B=v.width()}else{var y=w.find(".wbox-header").height();var s=w.find(".wbox-bottom").height();var C=v.height()-y-s;var E=w.find(".wbox-header .left").width();var D=w.find(".wbox-header .right").width();var B=v.width()-E-D}if(F.iframeWH.height){G.css("height",Math.min(C,F.iframeWH.height))}if(F.iframeWH.width){G.css("width",Math.min(B,F.iframeWH.width))}G.appendTo(z.empty());G.ready(function(){var I=top.$("#"+x);var H=I.find("iframe")[0];H.contentWindow.wboxWinParam=F.param;H=null;I=null});G.load(function(){m(x,F)});A=null;v=null;G=null;u=null}else{if(F.requestType&&F.requestType=="progressBar"){z.html("<div class='processbar'><span id='processbar'></span></div>");z.css({overflow:"auto",height:50,width:200});w.find(".wBox_close").remove()}else{if(F.html){z.html(F.html);z.css({overflow:"auto",height:F.iframeWH.height?Math.min(v.height(),F.iframeWH.height):400,width:F.iframeWH.width?Math.min(v.width(),F.iframeWH.width):600})}}}d(x,F);w=null;z=null}function m(u,s){var x=top.$("#"+u);try{x.find(".wBox_close").click(function(){p(u,null,null)});var w=x.find("iframe")[0];if(s.disableBackSpace){top.$(w.contentWindow.document).keydown(function(y){return f(y,s)})}w.contentWindow.document.title=s.title;w.contentWindow.wboxWinParam=s.param;w.contentWindow.closeWin=function(){p(u,s.onClose,arguments)};w.contentWindow.cancelWin=function(){p(u,null,null)};w.contentWindow.postWboxMsg=function(){return n(u,s.onMessage,arguments)};w=null;x=null}catch(v){}}function d(u,s){var v=top.$("#"+u);q(u,s);v.show().find(".wBox_close").click(function(){p(u,null,null)}).hover(function(){top.$(this).addClass("on")},function(){top.$(this).removeClass("on")});typeof s.callBack==="function"?s.callBack():null;if(s.timeout){setTimeout(p,s.timeout)}if(!s.fullScreen||s.drag!==false){j(u)}v=null}function q(z,F){var w=top.$("#"+z);var C=top.$("#wBox_overlay");var u=i(top.window);var y=i(top.window.document);if(!w){return false}var A=F.position;if(!A||(A.left==null&&A.right==null)){var s=w.width(),D=w.height();A=o(s,D,u)}w.css({left:A.left,top:A.top,right:A.right,bottom:A.bottom});var E=y.height(),x=u.height(),B=y.width(),v=u.width();E=Math.max(E,x);B=Math.max(B,v);C.height(E).width(B)}function o(u,x,y){var s=(y.width()-u)/2;var v=(y.height()-x)/2+y.scrollTop();return{left:s,top:v}}function j(y){var s=top.$("#"+y);var B,A,z;var v=s.find(".wBox_dragTitle").css("cursor","move");v.bind("selectstart",function(){return false});v.mousedown(function(C){B=C.clientX-parseInt(s.css("left"));A=C.clientY-parseInt(s.css("top"));s.mousemove(u).mouseout(w);v.mouseup(x)});function u(C){z=false;if(C.clientX-B<0){l=0}else{l=C.clientX-B}if(C.clientY-A<0){t=0}else{t=C.clientY-A}s.css({left:l,top:t})}function w(C){z=true;setTimeout(function(){z&&x(C)},10)}function x(C){s.unbind("mousemove",u).unbind("mouseout",w);v.unbind("mouseup",x)}}function n(u,v,s){if(typeof v==="function"){return v.apply(null,s)}}function e(s){s.closeWin=null;s.postWboxMsg=null;s.cancelWin=null}function p(u,y,s){var x=top.$("#"+u);if(x){try{var w=x.find("iframe")[0];if(w){e(w.contentWindow);i(w.contentWindow.document).unbind("keydown")}w=null}catch(v){}x.stop().fadeOut(300,function(){x.css("z-index",-900);x.addClass("wbox-delete").removeClass("wbox-live");var A=top.$(".wbox-live").length;var B=top.$("#wBox_overlay");if(A>0){var z=parseInt(B.css("z-index"));B.css("z-index",z-2)}else{B.remove()}if(navigator.userAgent.indexOf("MSIE")<0){x.find(".wBox_dragTitle").unbind("mousedown");x.remove()}x=null;if(typeof y==="function"){y.apply(null,s)}})}}function c(){var s=top.$(".wbox-delete");for(var u=1;u<s.size();u++){var v=top.$(s[u]);if(navigator.userAgent.indexOf("MSIE")>0){v.find("iframe").remove();CollectGarbage()}v.find(".wBox_dragTitle").unbind("mousedown");v.remove()}}function f(A,v){var y=A||this.event||window.event;if(!y||y.keyCode!=h){return}var z=y.target||y.srcElement;var x=i(z).prop("type");var u=z.isContentEditable;if(u===true){return true}if(x==null){return false}var w=a(x,v.disableBSInputType);if(w===true){return false}if(r(z)){return false}var s=i(z).prop("readonly");var w=i(z).prop("disabled");return(s===true||w===true)?false:true}function a(u,v){if(i.isArray(v)&&u){for(var s=0;s<v.length;s++){if(v[s]==u){return true}}}}function r(v,s){var u=i(v).prop("tagName").toLowerCase();if(u!="input"&&u!="textarea"){return true}return false}})(jQuery);